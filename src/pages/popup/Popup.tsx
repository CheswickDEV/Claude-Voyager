import React, { useEffect, useState } from "react";import { StorageService } from "../../core/services/StorageService";import type { AppSettings, FeatureFlags } from "../../core/types/storage";import { t, getPreferredLocale } from "../../i18n";const storage = StorageService.getInstance();type SaveState = "idle" | "saving" | "saved";export const Popup: React.FC = () => {  const [settings, setSettings] = useState<AppSettings | null>(null);  const [saveState, setSaveState] = useState<SaveState>("idle");  const locale = settings?.locale ?? getPreferredLocale();  useEffect(() => {    const load = async () => {      const stored = await storage.get("settings");      setSettings(stored);    };    void load();  }, []);  const updateFeature = (key: keyof FeatureFlags) => {    if (!settings) {      return;    }    setSettings({      ...settings,      features: {        ...settings.features,        [key]: !settings.features[key]      }    });  };  const handleSave = async () => {    if (!settings) {      return;    }    setSaveState("saving");    await storage.set("settings", settings);    setSaveState("saved");    window.setTimeout(() => setSaveState("idle"), 1200);  };  if (!settings) {    return <div style={{ padding: 16 }}>Loadingâ€¦</div>;  }  return (    <div style={{ padding: 16, minWidth: 260, fontFamily: "system-ui" }}>      <h1 style={{ fontSize: 18, marginBottom: 4 }}>{t("title", locale)}</h1>      <p style={{ marginTop: 0, color: "#666" }}>{t("subtitle", locale)}</p>      <label style={{ display: "flex", gap: 8, alignItems: "center", marginBottom: 8 }}>        <input          type="checkbox"          checked={settings.features.timelineEnabled}          onChange={() => updateFeature("timelineEnabled")}        />        {t("timelineLabel", locale)}      </label>      <label style={{ display: "flex", gap: 8, alignItems: "center", marginBottom: 8 }}>        <input          type="checkbox"          checked={settings.features.foldersEnabled}          onChange={() => updateFeature("foldersEnabled")}        />        {t("foldersLabel", locale)}      </label>      <label style={{ display: "flex", gap: 8, alignItems: "center", marginBottom: 8 }}>        <input          type="checkbox"          checked={settings.features.promptsEnabled}          onChange={() => updateFeature("promptsEnabled")}        />        {t("promptsLabel", locale)}      </label>      <label style={{ display: "flex", gap: 8, alignItems: "center", marginBottom: 16 }}>        <input          type="checkbox"          checked={settings.features.exportEnabled}          onChange={() => updateFeature("exportEnabled")}        />        {t("exportLabel", locale)}      </label>      <button type="button" onClick={handleSave} style={{ padding: "6px 12px" }}>        {saveState === "saved" ? t("saved", locale) : t("save", locale)}      </button>    </div>  );};